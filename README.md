# ⏱️ TimeCapsule

## 📌 목차  
- [프로젝트 요약](#📌-프로젝트-요약)  
- [진행 상황](#📅-진행-상황)  
- [구현 결과](#🖥-구현-결과)  
- [트러블 슈팅](#🛠-트러블-슈팅)  
- [학습한 내용](#📚-학습한-내용)  
- [느낀 점](#💬-느낀-점)  

---

## 📌 프로젝트 요약  

| 항목              | 상세 내용 |
|-----------------|--------------------------------------------------------------|
| **기여도**       | **100% (1인 개발)** |
| **프로젝트 목적** | 소셜 기능을 갖춘 디지털 타임캡슐 앱 개발 |
| **구현 기간**    | **2024.05.25 ~ 진행중 ** |
| **기술 스택**    | **Flutter / Dart / Firebase (Auth, Firestore, Storage) / Provider** |
| **핵심 기능**    | ✅ Firebase 기반 인증 시스템  <br> ✅ 온보딩 스와이프 화면  <br> ✅ 소셜 기능 (친구/팔로워 시스템)  <br> ✅ 커스텀 UI 컴포넌트  <br> ✅ 타임캡슐 생성/관리 시스템  <br> ✅ 실시간 데이터 동기화  |

---

## 📅 진행 상황  

| 날짜          | 작업 내용 |
|--------------|-------------------------------------------|
| **2025.05.25** | 📌 **프로젝트 기획 및 Firebase 초기 설정**  <br> - 온보딩 화면 구현 <br> - 소셜 기능 모델링  <br> - Firebase 인증 시스템 구현 <br> - 커스텀 UI 컴포넌트 개발|
| **2025.05.31** | 📌 **타임캡슐 핵심 기능 구현**  <br> - 타임캡슐 생성 페이지 완성 <br> - 타임캡슐 목록 페이지 구현  <br> - Firebase Firestore 연동 <br> - 실시간 스트림 데이터 처리 <br> - 복합 쿼리 및 인덱스 최적화|

---

## 🖥 구현 결과

### 앱 주요 화면

<table>
<tr>
<td align="center" width="25%"><strong>온보딩 화면</strong><br>스와이프 가능한 4개 페이지<br>타임캡슐 주요 기능 소개</td>
<td align="center" width="25%"><strong>로그인 화면</strong><br>Firebase Authentication 연동<br>유효성 검증 포함</td>
<td align="center" width="25%"><strong>회원가입 화면</strong><br>실시간 폼 검증<br>이용약관 동의 기능</td>
<td align="center" width="25%"><strong>타임캡슐 목록</strong><br>받은/보낸 캡슐 탭<br>실시간 상태 업데이트</td>
</tr>
</table>

### 핵심 기능

#### 1. 타임캡슐 관리 시스템
- **캡슐 생성**: 제목, 내용, 미디어 첨부, 수신자 선택, 열림 날짜 설정
- **실시간 목록**: StreamBuilder를 활용한 받은/보낸 캡슐 실시간 동기화
- **상태 관리**: 예약됨/배송됨/열림 상태에 따른 UI 변화
- **권한 제어**: 캡슐 작성자와 수신자만 접근 가능
- **좋아요 기능**: 열린 캡슐에 대한 반응 시스템

#### 2. 소셜 타임캡슐 시스템
- **친구/팔로워 관리**: 사용자 간 관계 설정 및 관리
- **친구 요청 시스템**: 요청 보내기/받기, 승인/거절 기능
- **공유 캡슐**: 특정 사용자들에게만 전송 가능한 타임캡슐
- **가시성 설정**: 개인/친구 공개 범위 선택

#### 3. Firebase 기반 백엔드
- **Authentication**: 이메일/비밀번호 인증
- **Firestore**: 실시간 데이터베이스로 타임캡슐 및 사용자 데이터 관리
- **실시간 동기화**: Stream 기반 데이터 변화 감지
- **복합 쿼리**: 수신자/발신자별 캡슐 필터링

#### 4. 사용자 경험
- **온보딩**: 스와이프 가능한 앱 소개
- **반응형 UI**: 다양한 화면 크기 대응
- **에러 처리**: 사용자 친화적 피드백 시스템
- **로딩 상태**: 우아한 로딩 인디케이터
- **빈 상태**: 의미있는 빈 상태 메시지

---

## 🛠 트러블 슈팅

### 🔹 문제 1: 온보딩 화면 Bottom Overflow
- **원인:** 고정 높이 사용으로 인한 작은 화면에서의 레이아웃 오버플로우
- **해결:** `Flexible`과 `Expanded`를 활용한 반응형 레이아웃 구현, `MediaQuery`로 동적 화면 크기 계산

### 🔹 문제 2: CustomButton 아이콘 미지원
- **원인:** 기존 CustomButton 위젯에서 icon 파라미터가 정의되지 않음
- **해결:** icon, iconSize 파라미터 추가 및 아이콘-텍스트 조합 레이아웃 구현

### 🔹 문제 3: Firebase 초기화 타이밍 이슈
- **원인:** main() 함수에서 Firebase 초기화 전에 위젯 실행
- **해결:** `WidgetsFlutterBinding.ensureInitialized()` 추가 및 async/await 패턴 적용

### 🔹 문제 4: 이미지 에셋 경로 문제
- **원인:** 온보딩 이미지 경로 불일치로 인한 이미지 로드 실패
- **해결:** assets 경로 통일 및 에러 처리가 포함된 이미지 위젯 구현

### 🔹 문제 5: 회원가입 화면 import 충돌
- **원인:** hide 절 사용으로 인한 CustomTextField, CustomButton 중복 import
- **해결:** 정확한 경로 지정 및 hide 절 제거로 충돌 해결

### 🔹 문제 6: Firestore 복합 인덱스 에러
- **원인:** `arrayContains`와 `whereIn`을 동시 사용하여 복합 인덱스 필요
- **해결:** 서버 사이드 필터링을 단순화하고 클라이언트 사이드에서 추가 필터링 적용

### 🔹 문제 7: final 변수 상태 변경 에러
- **원인:** `final DateTime _selectedDate`로 선언하여 날짜 변경 불가
- **해결:** `DateTime _selectedDate`로 변경하여 mutable 상태로 수정

### 🔹 문제 8: currentUserId 접근 에러
- **원인:** CapsuleService에서 AuthService의 currentUser에 직접 접근 시도
- **해결:** CapsuleService에 `currentUserId` getter 추가로 캡슐화 개선

### 🔹 문제 9: 코드 구조 및 문법 오류
- **원인:** 불완전한 메서드 구현, 잘못된 할당 연산자 사용, 중복 코드
- **해결:** 코드 리팩토링을 통한 구조 정리 및 문법 오류 수정

---

## 📚 학습한 내용

### ✅ 1. Firebase 프로젝트 설정 및 Flutter 연동
- FlutterFire CLI를 활용한 자동 설정 방법 학습
- Android/iOS 플랫폼별 Firebase 설정 파일 관리
- DefaultFirebaseOptions 클래스를 통한 멀티 플랫폼 지원

### ✅ 2. Firebase Authentication 심화
- FirebaseAuth와 Firestore 연동을 통한 사용자 데이터 관리
- 실시간 인증 상태 변화 감지 및 UI 업데이트
- 사용자 등록 시 Firestore 문서 자동 생성 패턴

### ✅ 3. Firestore 데이터 모델링 및 쿼리 최적화
- NoSQL 특성을 고려한 효율적인 데이터 구조 설계
- 중첩 데이터와 참조를 활용한 관계형 데이터 표현
- 쿼리 최적화를 위한 인덱스 필드 활용 방법
- **복합 쿼리 제한 사항**: `arrayContains`와 `whereIn` 동시 사용 시 인덱스 필요성
- **클라이언트 사이드 필터링**: 서버 쿼리 단순화 후 Flutter에서 추가 필터링

### ✅ 4. Flutter 상태 관리 패턴
- Stream 기반 실시간 데이터 바인딩
- StatefulWidget과 Firebase Stream의 효율적 연동
- 메모리 누수 방지를 위한 리소스 해제 패턴
- **StreamBuilder 활용**: 실시간 데이터 변화를 UI에 반영하는 패턴

### ✅ 5. 커스텀 위젯 개발 및 코드 구조화
- 재사용 가능한 UI 컴포넌트 설계 원칙
- 파라미터 기반 위젯 커스터마이징 기법
- 일관된 디자인 시스템 구축 방법론
- **Service Layer 패턴**: 비즈니스 로직을 Service 클래스로 분리
- **Singleton 패턴**: CapsuleService에서 인스턴스 관리

### ✅ 6. 반응형 UI 설계 및 UX 개선
- MediaQuery를 활용한 동적 레이아웃 계산
- Flexible과 Expanded의 적절한 활용
- 다양한 화면 크기에 대응하는 UI 패턴
- **로딩 상태 관리**: CircularProgressIndicator와 의미있는 메시지
- **빈 상태 디자인**: 사용자 안내가 포함된 EmptyState 위젯

### ✅ 7. 폼 유효성 검증 및 사용자 입력 처리
- 실시간 폼 검증 및 사용자 피드백
- 정규 표현식을 활용한 이메일/비밀번호 검증
- 사용자 경험을 고려한 에러 메시지 디자인
- **TextEditingController**: 입력값 변화 감지 및 실시간 검증

### ✅ 8. 소셜 기능 아키텍처 설계
- 사용자 간 관계 모델링 (친구, 팔로워, 팔로잉)
- 친구 요청 시스템의 상태 관리
- 권한 기반 콘텐츠 접근 제어 설계
- **수신자 선택 UI**: 친구 목록에서 다중 선택 인터페이스

### ✅ 9. 에러 처리 및 디버깅
- Try-catch 블록을 활용한 예외 처리
- 사용자 친화적 에러 메시지 디스플레이
- **Debug 로깅**: print문을 활용한 개발 단계 디버깅
- **Null Safety**: Dart의 null safety 기능 활용

### ✅ 10. 타임캡슐 특화 기능 개발
- **DateTime 처리**: 미래 날짜 선택 및 계산
- **상태 기반 UI**: 캡슐 상태에 따른 동적 인터페이스
- **권한 기반 기능**: 캡슐 열기, 좋아요 등 권한 검증
- **애니메이션**: 페이드 인/아웃, 헤더 축소 애니메이션

---

## 💬 느낀 점

Firebase를 활용한 실제 소셜 앱 개발을 통해 백엔드 없이도 완전한 기능을 구현할 수 있음을 체험했습니다. 특히 Firebase Authentication과 Firestore의 실시간 동기화 기능이 Flutter의 상태 관리와 자연스럽게 연동되어 효율적인 개발이 가능했습니다.

온보딩 화면 개발 과정에서 반응형 UI의 중요성을 다시 한번 깨달았습니다. 처음에는 고정 크기로 구현했지만, 다양한 화면 크기에서 발생하는 오버플로우 문제를 해결하면서 `Flexible`과 `MediaQuery`의 강력함을 이해할 수 있었습니다.

커스텀 위젯 개발 과정에서는 재사용성과 확장성을 고려한 설계의 중요성을 배웠습니다. CustomButton에 아이콘 기능을 추가하면서, 초기 설계 시 확장 가능성을 염두에 두는 것이 얼마나 중요한지 실감했습니다.

가장 인상 깊었던 것은 소셜 기능을 위한 데이터 모델링 과정입니다. 단순히 User 모델에서 시작해서 친구 관계, 팔로워 시스템, 타임캡슐 공유 권한까지 확장하면서 NoSQL 데이터베이스의 유연성과 동시에 신중한 설계의 필요성을 느꼈습니다.

**타임캡슐 핵심 기능 개발 과정**에서는 실제 사용자가 사용할 수 있는 완성도 높은 기능을 구현하는 경험을 했습니다. 특히 **Firestore의 복합 쿼리 제한사항**을 마주하면서 NoSQL 데이터베이스의 특성을 더 깊이 이해하게 되었고, 클라이언트 사이드 필터링이라는 대안적 접근법을 학습할 수 있었습니다.

**StreamBuilder를 활용한 실시간 데이터 처리**는 기존의 REST API 방식과는 완전히 다른 개발 패러다임을 경험하게 해주었습니다. 데이터 변화가 즉시 UI에 반영되는 것을 보면서 현대적인 앱 개발의 방향성을 느낄 수 있었습니다.

코드 구조화와 에러 처리의 중요성도 다시 한번 깨달았습니다. 초기에는 빠른 구현에만 집중했지만, 코드가 복잡해지면서 **Service Layer 패턴**과 **적절한 캡슐화**의 필요성을 실감했습니다. 특히 `CapsuleService`에 `currentUserId` getter를 추가하면서 깔끔한 API 설계의 중요성을 배웠습니다.

Firebase의 실시간 기능을 활용하면서 전통적인 REST API와는 다른 개발 패러다임을 경험할 수 있었고, 이는 향후 실시간 협업 앱이나 채팅 앱 개발에 큰 도움이 될 것 같습니다.

---

## 📌 향후 계획

1. **미디어 업로드 기능**: Firebase Storage 연동으로 이미지/비디오 첨부
2. **친구 관리 시스템 완성**: 친구 찾기, 요청 관리, 친구 목록 화면
3. **알림 시스템**: 푸시 알림 및 타임캡슐 열람 시간 알림
4. **캐싱 및 성능 최적화**: 이미지 캐싱, 데이터 페이지네이션
5. **위치 기반 기능**: 특정 장소에서 열리는 타임캡슐 구현
6. **UI/UX 개선**: 다크 모드, 고급 애니메이션, 접근성 향상
7. **오프라인 지원**: 네트워크 연결이 불안정한 환경에서의 사용성 개선
8. **테스트 코드 작성**: Unit Test 및 Widget Test를 통한 안정성 확보
